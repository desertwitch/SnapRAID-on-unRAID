Menu="dwsnapOps:1"
Title="SnapRAID Settings"
Tag="cogs"
Markdown="false"
---
<? require_once '/usr/local/emhttp/plugins/dwsnap/include/dwsnap_config.php'; ?>

<span style="float:right;margin-right:10px"><a href="https://www.snapraid.it/manual" target="_blank" title="SnapRAID User Manual"><i class="fa fa-file-text-o"></i> <u>User Manual</u></a> / <a href="https://www.snapraid.it/faq" target="_blank" title="SnapRAID FAQ"><i class="fa fa-question-circle-o"></i> <u>Frequently Asked Questions</u></a></span>

<div><strong>WARNING:</strong></div>
<div>SnapRAID is a non-supported backup utility for advanced users and can - depending on how YOU set it up - wreak havoc on your system.</div>
<div>Please make yourself familiar with the documentation before trying any unfamiliar SnapRAID commands - you are warned only once here.</div>

<br>

<form markdown="0" id="dwsnap-settings" name="dwsnap_settings" method="POST" action="/update.php" target="progressFrame">
<input type="hidden" name="#file" value="dwsnap/dwsnap.cfg">
<input type="hidden" id="command2" name="#command" value="/usr/local/emhttp/plugins/dwsnap/scripts/write_config">
<dl>
    <dt>SnapRAID Backend:</dt>
    <dd>
	    <strong><?= isset($snapraid_backend) && $snapraid_backend ? $snapraid_backend : "n/a" ?></strong>
    </dd>
</dl>

<dl>
    <dt>SnapRAID I/O Process Priority:</dt>
    <dd>
        <select class="snaprun" id="PRIO" name="PRIO" size="1">
            <?=mk_option($dwsnap_prio, "disable", "System Default");?>
            <?=mk_option($dwsnap_prio, "idle", "Idle");?>
            <?=mk_option($dwsnap_prio, "besteffort", "Best Effort");?>
            <?=mk_option($dwsnap_prio, "realtime", "Real Time");?>
        </select>
    </dd>
</dl>

<blockquote class="inline_help">
</blockquote>

<hr>

<dl>
    <dt><strong>SnapRAID Maintenance - Cron Schedule:</strong></dt>
    <dd>
        <select class="snaprun" id="CRON" name="CRON" size="1">
            <?=mk_option($dwsnap_cron, "disable", "Never");?>
            <?=mk_option($dwsnap_cron, "hourly", "Hourly");?>
            <?=mk_option($dwsnap_cron, "daily", "Daily");?>
            <?=mk_option($dwsnap_cron, "weekly", "Weekly");?>
            <?=mk_option($dwsnap_cron, "monthly", "Monthly");?>
        </select>
    </dd>
</dl>

<blockquote class="inline_help">
</blockquote>

<div id="CRONDOWSETTING">
    <dl>
        <dt>SnapRAID Maintenance - Cron Schedule <em>Day of Week</em>:</dt>
        <dd>
            <select class="snaprun" id="CRONDOW" name="CRONDOW" size="1">
                <?=mk_option($dwsnap_crondow, "0", "Sunday");?>
                <?=mk_option($dwsnap_crondow, "1", "Monday");?>
                <?=mk_option($dwsnap_crondow, "2", "Tuesday");?>
                <?=mk_option($dwsnap_crondow, "3", "Wednesday");?>
                <?=mk_option($dwsnap_crondow, "4", "Thursday");?>
                <?=mk_option($dwsnap_crondow, "5", "Friday");?>
                <?=mk_option($dwsnap_crondow, "6", "Saturday");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>
</div>

<div id="CRONDOMSETTING">
    <dl>
        <dt>SnapRAID Maintenance - Cron Schedule <em>Day of Month</em>:</dt>
        <dd>
            <select class="snaprun" id="CRONDOM" name="CRONDOM" size="1">
                <? echo snap_dom_options($dwsnap_crondom);?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>
</div>

<div id="CRONHOURSETTING">
    <dl>
        <dt>SnapRAID Maintenance - Cron Schedule <em>Hour</em>:</dt>
        <dd>
            <select class="snaprun" id="CRONHOUR" name="CRONHOUR" size="1">
                <? echo snap_hour_options($dwsnap_cronhour);?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>
</div>

<div id="CRONSETTINGS">
    <dl>
        <dt>SnapRAID Maintenance - Cron Notifications:</dt>
        <dd>
            <select class="snaprun" id="NOTIFY" name="NOTIFY" size="1">
                <?=mk_option($dwsnap_notify, "disable", "No");?>
                <?=mk_option($dwsnap_notify, "enable", "Yes");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <hr>

    <dl>
        <dt><strong>SnapRAID Maintenance - <u>Touch</u> (Step 1):</strong></dt>
        <dd>
            <select class="snaprun" id="TOUCH" name="TOUCH" size="1">
                <?=mk_option($dwsnap_touch, "disable", "No");?>
                <?=mk_option($dwsnap_touch, "enable", "Yes");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <dl>
        <dt><strong>SnapRAID Maintenance - <u>Diff</u> / Check Thresholds (Step 2):</strong></dt>
        <dd>
            <select class="snaprun" id="DIFF" name="DIFF" size="1">
                <?=mk_option($dwsnap_diff, "disable", "No");?>
                <?=mk_option($dwsnap_diff, "enable", "Yes");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <dl>
        <dt>SnapRAID Maintenance - <em>Added</em> Files Threshold:</dt>
        <dd>
            <input id="ADDED" type="text" class="narrow snaprun" name="ADDED" maxlength="30" value="<?=$dwsnap_added?>">
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <dl>
        <dt>SnapRAID Maintenance - <em>Deleted</em> Files Threshold:</dt>
        <dd>
            <input id="DELETED" type="text" class="narrow snaprun" name="DELETED" maxlength="30" value="<?=$dwsnap_deleted?>">
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <dl>
        <dt>SnapRAID Maintenance - <em>Updated</em> Files Threshold:</dt>
        <dd>
            <input id="UPDATED" type="text" class="narrow snaprun" name="UPDATED" maxlength="30" value="<?=$dwsnap_updated?>">
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <dl>
        <dt>SnapRAID Maintenance - <em>Moved</em> Files Threshold:</dt>
        <dd>
            <input id="MOVED" type="text" class="narrow snaprun" name="MOVED" maxlength="30" value="<?=$dwsnap_moved?>">
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <dl>
        <dt>SnapRAID Maintenance - <em>Copied</em> Files Threshold:</dt>
        <dd>
            <input id="COPIED" type="text" class="narrow snaprun" name="COPIED" maxlength="30" value="<?=$dwsnap_copied?>">
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <dl>
        <dt>SnapRAID Maintenance - <em>Restored</em> Files Threshold:</dt>
        <dd>
            <input id="RESTORED" type="text" class="narrow snaprun" name="RESTORED" maxlength="30" value="<?=$dwsnap_restored?>">
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <dl>
        <dt><strong>SnapRAID Maintenance - <u>Sync</u> (Step 3):</strong></dt>
        <dd>
            <select class="snaprun" id="SYNC" name="SYNC" size="1">
                <?=mk_option($dwsnap_sync, "disable", "No");?>
                <?=mk_option($dwsnap_sync, "enable", "Yes");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>

    <div id="PREHASHSETTING">
        <dl>
            <dt>SnapRAID Maintenance - Sync as Prehashed Sync:</dt>
            <dd>
                <select class="snaprun" id="PREHASH" name="PREHASH" size="1">
                    <?=mk_option($dwsnap_prehash, "disable", "No");?>
                    <?=mk_option($dwsnap_prehash, "enable", "Yes");?>
                </select>
            </dd>
        </dl>

        <blockquote class="inline_help">
        </blockquote>
    </div>

    <dl>
        <dt><strong>SnapRAID Maintenance - <u>Scrub</u> (Step 4):</strong></dt>
        <dd>
            <select class="snaprun" id="SCRUB" name="SCRUB" size="1">
                <?=mk_option($dwsnap_scrub, "disable", "No");?>
                <?=mk_option($dwsnap_scrub, "enable", "Yes");?>
            </select>
        </dd>
    </dl>

    <blockquote class="inline_help">
    </blockquote>
</div>

<dl>
    <dt>
        <input id="DEFAULT" type="submit" name="#default" value="Default">
        <input id="RESETCONF" class="snaprun" type="button" value="Reset Config">
    </dt>
    <dd>
        <input type="submit" id="btnApply" name="#apply" value="Apply">
        <input type="button" value="Done" onclick="done()">
    </dd>
</dl>

</form>

<script type="text/javascript">
function checkCronSettings() {
    if ($("#SYNC").val() === "enable") {
        $("#PREHASHSETTING").show();
    } else {
        $("#PREHASHSETTING").hide();
    }
    if ($("#CRON").val() === "hourly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").hide();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "daily") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "weekly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").show();
        $("#CRONDOMSETTING").hide();
    } else if ($("#CRON").val() === "monthly") {
        $("#CRONSETTINGS").show();
        $("#CRONHOURSETTING").show();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").show();
    } else {
        $("#CRONSETTINGS").hide();
        $("#CRONHOURSETTING").hide();
        $("#CRONDOWSETTING").hide();
        $("#CRONDOMSETTING").hide();
    }
}
$(function(){
    $('#btnApply').click(function(){
        $('#dwsnap-settings').submit();
    });
    $("#SYNC").change(checkCronSettings);
    $("#CRON").change(checkCronSettings);
    checkCronSettings();
});
</script>
    
